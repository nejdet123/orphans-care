<!-- ğŸ›ï¸ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© Ø¶Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
<div class="card card-dark p-4 mb-4">
  <h5 class="mb-3"><i class="bi bi-funnel"></i> ÙÙ„Ø§ØªØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h5>
  <form id="filterForm" class="row g-3">
    <div class="col-md-3">
      <label for="organizationFilter" class="form-label">Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</label>
      <select id="organizationFilter" class="form-select">
        <option value="">Ø§Ù„ÙƒÙ„</option>
      </select>
    </div>
    <div class="col-md-3">
      <label for="organizationCodeFilter" class="form-label">ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</label>
      <input type="text" id="organizationCodeFilter" class="form-control" placeholder="Ù…Ø«Ø§Ù„: ORG-1">
    </div>
    <div class="col-md-3">
      <label for="ageGroupFilter" class="form-label">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©</label>
      <select id="ageGroupFilter" class="form-select">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <option value="(6-12 Ø³Ù†Ø©)">(6-12 Ø³Ù†Ø©)</option>
        <option value="(13-18 Ø³Ù†Ø©)">(13-18 Ø³Ù†Ø©)</option>
        <option value="(ÙÙˆÙ‚ 18 Ø³Ù†Ø©)">(ÙÙˆÙ‚ 18 Ø³Ù†Ø©)</option>
      </select>
    </div>
    <div class="col-md-3">
      <label for="trainingFilter" class="form-label">ØªÙ„Ù‚Ù‰ ØªØ¯Ø±ÙŠØ¨Ù‹Ø§ Ø³Ø§Ø¨Ù‚Ù‹Ø§</label>
      <select id="trainingFilter" class="form-select">
        <option value="">Ø§Ù„ÙƒÙ„</option>
        <option value="Ù†Ø¹Ù…">Ù†Ø¹Ù…</option>
        <option value="Ù„Ø§">Ù„Ø§</option>
      </select>
    </div>
    <div class="col-12 text-end">
      <button type="submit" class="btn btn-outline-light"><i class="bi bi-funnel"></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
    </div>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("filterForm");

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      applyFilters();
    });
  });

  async function applyFilters() {
    const res = await fetch('/api/survey-data');
    const data = await res.json();

    const org = document.getElementById("organizationFilter").value.trim();
    const code = document.getElementById("organizationCodeFilter").value.trim();
    const age = document.getElementById("ageGroupFilter").value;
    const training = document.getElementById("trainingFilter").value;

    let filtered = data.filter(row => {
      return (!org || row.organization === org) &&
             (!code || row.organizationCode?.toLowerCase().includes(code.toLowerCase())) &&
             (!age || row.ageGroups?.includes(age)) &&
             (!training || row.previousTraining === training);
    });

    console.log("ğŸ” Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØµÙÙŠØ©:", filtered);
    updateGeneralStatistics(filtered);
    drawDomainsChart(filtered);
  }
</script>

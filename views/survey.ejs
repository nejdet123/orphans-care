<section class="survey-page">
    <div class="container">
        <h1 class="text-center my-4">استبيان تقييم الاحتياجات التدريبية</h1>
        <p class="text-center mb-5">للكوادر العاملة مع الأيتام في المنظمات الإنسانية</p>
        
        <div class="survey-container">
            <div class="survey-intro">
                <h3>تعليمات الاستبيان:</h3>
                <ul>
                    <li>يرجى الإجابة على جميع الأسئلة بدقة وموضوعية.</li>
                    <li>تستغرق الإجابة على الاستبيان حوالي 30-40 دقيقة.</li>
                    <li>تقييم المهارات يكون من 1 إلى 5 (1: منخفضة جداً، 5: عالية جداً).</li>
                    <li>جميع البيانات ستعامل بسرية تامة ولن تستخدم إلا لأغراض تطوير البرامج التدريبية.</li>
                    <li>يتكون الاستبيان من ثلاثة أقسام رئيسية: البيانات الشخصية والوظيفية، تقييم الاحتياجات التدريبية، والاقتراحات والملاحظات.</li>
                </ul>
            </div>
            
            <form id="surveyForm" action="/survey" method="POST">
                <!-- القسم الأول: البيانات الشخصية والوظيفية -->
                <div class="survey-section">
                    <h3 class="survey-section-title">القسم الأول: البيانات الشخصية والوظيفية</h3>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="fullName" class="form-label">الاسم الكامل (اختياري)</label>
                            <input type="text" class="form-control" id="fullName" name="fullName">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="organizationCode" class="form-label">كود المنظمة</label>
                            <input type="text" class="form-control" id="organizationCode" name="organizationCode" required>
                        </div>
                    </div>
                    
                    <!-- المزيد من الحقول هنا... -->

                </div>
                
                <!-- القسم الثاني: تقييم الاحتياجات التدريبية -->
                <div class="survey-section">
                    <h3 class="survey-section-title">القسم الثاني: تقييم الاحتياجات التدريبية</h3>
                    <p class="mb-4">يرجى تحديد درجة احتياجك للتدريب في كل مجال من المجالات التالية، وذلك باختيار الدرجة المناسبة وفق المقياس التالي:</p>
                    <p class="mb-4">(1) منخفضة جداً، (2) منخفضة، (3) متوسطة، (4) عالية، (5) عالية جداً</p>
                    
                    <!-- المزيد من الجداول الخاصة بتقييم الاحتياجات التدريبية هنا... -->
                    
                </div>

                <!-- القسم الثالث: الاقتراحات والملاحظات -->
                <div class="survey-section">
                    <h3 class="survey-section-title">القسم الثالث: الاقتراحات والملاحظات</h3>
                    
                    <div class="row">
                        <div class="col-12 mb-4">
                            <label for="otherTrainingAreas" class="form-label">ما هي المجالات التدريبية الأخرى التي ترى أنها مهمة لتطوير مهاراتك في رعاية الأيتام؟</label>
                            <textarea class="form-control" id="otherTrainingAreas" name="otherTrainingAreas" rows="5"></textarea>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12 mb-4">
                            <label for="suggestions" class="form-label">ما هي اقتراحاتك لتطوير برامج التدريب المقدمة للعاملين في مجال رعاية الأيتام؟</label>
                            <textarea class="form-control" id="suggestions" name="suggestions" rows="5"></textarea>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn-submit">إرسال الاستبيان</button>
            </form>

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const surveyForm = document.getElementById('surveyForm');
                    if (!surveyForm) return;

                    surveyForm.addEventListener('submit', async function(e) {
                        e.preventDefault();

                        const formData = new FormData(surveyForm);
                        const formDataObj = {};

                        formData.forEach((value, key) => {
                            if (key.endsWith('[]')) {
                                const actualKey = key.slice(0, -2);
                                if (!formDataObj[actualKey]) {
                                    formDataObj[actualKey] = [];
                                }
                                formDataObj[actualKey].push(value);
                            } else {
                                formDataObj[key] = value;
                            }
                        });

                        try {
                            const response = await fetch('/api/survey-data', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(formDataObj)
                            });

                            const result = await response.json();

                            if (result.success) {
                                window.location.href = '/thank-you';
                            } else {
                                alert('حدث خطأ أثناء إرسال الاستبيان: ' + (result.message || 'يرجى المحاولة لاحقًا.'));
                            }
                        } catch (error) {
                            console.error('خطأ في إرسال الاستبيان:', error);
                            alert('حدث خطأ أثناء إرسال الاستبيان. يرجى المحاولة مرة أخرى.');
                        }
                    });
                });
            </script>
        </div>
    </div>
</section>

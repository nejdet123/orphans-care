<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title><%= surveyIntro?.title || 'استبيان تقييم الاحتياجات' %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; padding: 2rem; }
    .section-title { color: #0d6efd; margin-top: 2rem; }
    .question { margin-bottom: 1.5rem; }
    .form-check { margin-bottom: 0.5rem; }
  </style>
</head>
<body>

<div class="container">
  <h1 class="mb-4 text-primary"><%= surveyIntro.title %></h1>
  <p class="mb-5 lead"><%= surveyIntro.description %></p>

  <form action="/submit-survey" method="POST">
    <% sections.forEach(section => { %>
      <div class="section mb-5">
        <h2 class="section-title h4"><%= section.title %></h2>

        <% section.subsections.forEach(sub => { %>
          <div class="mb-4">
            <h5 class="mb-3"><%= sub.title %></h5>

            <% sub.questions.forEach(q => { %>
              <div class="question">
                <label class="form-label fw-semibold"><%= q.number %>. <%= q.text %>
                  <% if (q.required) { %><span class="text-danger">*</span><% } %>
                </label>

                <% if (q.type === 'text') { %>
                  <input type="text" class="form-control" name="<%= q.id %>" placeholder="<%= q.placeholder || '' %>" <%= q.required ? 'required' : '' %> />

                <% } else if (q.type === 'radio') { %>
                  <% q.options.forEach(opt => { %>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="<%= q.id %>" value="<%= opt.value %>" <%= q.required ? 'required' : '' %>>
                      <label class="form-check-label"><%= opt.text %></label>
                    </div>
                  <% }) %>

                <% } else if (q.type === 'checkbox') { %>
                  <% q.options.forEach(opt => { %>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" name="<%= q.id %>[]"
                             value="<%= opt.value %>">
                      <label class="form-check-label"><%= opt.text %></label>
                    </div>
                  <% }) %>
                  <% if (q.other?.enabled) { %>
                    <input type="text" class="form-control mt-2" name="<%= q.id %>_other" placeholder="<%= q.other.placeholder %>">
                  <% } %>

                <% } else if (q.type === 'textarea') { %>
                  <textarea class="form-control" name="<%= q.id %>" rows="<%= q.rows || 4 %>" placeholder="<%= q.placeholder || '' %>"></textarea>

                <% } else if (q.type === 'multi_text') { %>
                  <% q.fields.forEach(field => { %>
                    <input type="text" class="form-control mb-2" name="<%= field.id %>" placeholder="<%= field.placeholder %>">
                  <% }) %>

                <% } else if (q.type === 'ranking') { %>
                  <% q.options.forEach(opt => { %>
                    <div class="mb-2">
                      <label><%= opt.text %></label>
                      <select class="form-select" name="<%= q.id %>_<%= opt.value %>">
                        <% for (let i = 1; i <= q.maxRank || 5; i++) { %>
                          <option value="<%= i %>"><%= i %></option>
                        <% } %>
                      </select>
                    </div>
                  <% }) %>
                  <% if (q.other?.enabled) { %>
                    <input type="text" class="form-control mt-2" name="<%= q.id %>_other" placeholder="<%= q.other.placeholder %>">
                  <% } %>

                <% } else if (q.type === 'likert') { %>
                  <div class="d-flex gap-2 flex-wrap">
                    <% q.scale.forEach(scaleOpt => { %>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="<%= q.id %>" value="<%= scaleOpt.value %>" <%= q.required ? 'required' : '' %>>
                        <label class="form-check-label"><%= scaleOpt.text %></label>
                      </div>
                    <% }) %>
                  </div>

                <% } %>
              </div>
            <% }) %>
          </div>
        <% }) %>
      </div>
    <% }) %>

    <button type="submit" class="btn btn-success btn-lg px-5">إرسال الاستبيان</button>
  </form>
</div>

</body>
</html>
